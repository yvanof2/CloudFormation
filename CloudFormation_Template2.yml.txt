
AWSTemplateFormatVersion: 2010-09-09
Description: >-
  AWS CloudFormation Sample to create an EC2 instance restricted to two users.
Parameters:
  KeyName:
    Description: Name of an existing EC2 KeyPair to enable SSH access to the instance
    Type: 'AWS::EC2::KeyPair::KeyName'
    ConstraintDescription: must be the name of an existing EC2 KeyPair.
 
  InstanceType:
    Description: WebServer EC2 instance type
    Type: String
    Default: t2.small
    
    ConstraintDescription: must be a valid EC2 instance type.
 
Resources:
  WebServerInstance:
    Type: 'AWS::EC2::Instance
    
  WebServerSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      GroupDescription: Enable HTTPS access via port 443 and SSH via port 22 with only two Ip addresses allowed
      SecurityGroupIngress:
         - IpProtocol: tcp
          FromPort: '22'
          ToPort: '22'
          CidrIp: 204.13.56.3, 176.33.122.64
         - IpProtocol: tcp
          FromPort: '443'
          ToPort: '443'
          CidrIp: 0.0.0.0/0
Outputs:
  WebsiteURL:
    Description: URL for newly created WebServer 
    Value: !Join 
      - ''
      - - 'https://'
        - !GetAtt 
          - WebServerInstance
          - PublicDnsName
        